SKYPE.namespace("util");SKYPE.util.ClientDetection=function(){var _loaded=false;var _available=false;var _detectionSwfUrl="https://secure.skype.com/i/common/swf/detection_as3.swf";var _detectionSwfID="detectionswf";var _containerID="detection-container";var _failureTimeout=5000;var _verbose=false;var D=YAHOO.util.Dom;var E=YAHOO.util.Event;var _so={};var _sessionso={};var _loadDetection=function(){if(_loaded){return;}if(typeof SWFObject=="undefined"){return;}var container=D.get(_containerID);if(!container){container=document.createElement("DIV");container.id=_containerID;D.setStyle(container,"position","absolute");D.setStyle(container,"width","10px");D.setStyle(container,"height","10px");D.setStyle(container,"font","1px monospace");D.setStyle(container,"top","0px");D.setStyle(container,"left","-10px");D.setStyle(container,"overflow","hidden");document.body.appendChild(container);log("Created detection container div#"+_containerID);}var so=new SWFObject(_detectionSwfUrl,_detectionSwfID,"10","10","9","#FFFFFF");so.addParam("allowScriptAccess","always");so.write(_containerID);log("Created Flash detection object inside container");_loaded=true;window.setTimeout(_failureCheck,_failureTimeout);};var _getItem=function(name){if(typeof _so[name]=="undefined"||_so[name]==null||(typeof _so[name]=="string"&&!_so[name].length)||_so[name]=="null"){return null;}return _so[name];};var _failureCheck=function(){if(!_available){log("Triggering failure since failure check timout was called");onDetectionFailure.fire();}};var _readSWFData=function(){try{log("Reading detection data from SWF");var swf=D.get(_detectionSwfID);var soData=swf.getSharedObjectData();var sessionData=swf.getSessionData();SKYPE.util.ClientDetection.setSharedObjectData(soData,sessionData);}catch(e){log("Reading data from detection SWF failed - "+e);}};var log=function(msg){if(_verbose&&typeof console!="undefined"&&console.log){console.log("[ClientDetection] "+msg);}};var onDetectionAvailable=new YAHOO.util.CustomEvent("onDetectionAvailable");var onDetectionFailure=new YAHOO.util.CustomEvent("onDetectionFailure");onDetectionAvailable.subscribe(function(){_available=true;YAHOO.util.Dom.setStyle(_containerID,"visibility","hidden");});return{setVerbose:function(verbose){_verbose=verbose;log("Toggled verbose mode on");},setSWF:function(swfUrl){_detectionSwfUrl=swfUrl;log("Set SWF URL to "+swfUrl);},isReady:function(){return _available;},ready:function(){log("Got notice from Flash detection that it is ready");window.setTimeout(_readSWFData,10);return true;},setSharedObjectData:function(data,sessionData){_so=data;_sessionso=sessionData||{};log("Set detection data inside ClientDetection, calling onDetectionAvailable event");onDetectionAvailable.fire();return true;},isInstalled:function(){return _getItem("ui_version")!=null;},isAbandonedInstall:function(){var installDate=_getItem("ui_installdate");var timeNow=(new Date()).getTime()/1000;var downloadDate=_getItem("download_date");var timeFromDownload=timeNow-downloadDate;var minAbandonTime=5*60;var maxAbandonTime=8*24*60*60;return(installDate==null&&downloadDate!=null&&timeFromDownload>minAbandonTime&&timeFromDownload<maxAbandonTime);},getVersion:function(){return _getItem("ui_version");},getPlatform:function(){var version=_getItem("os_version");if(version){if(version.indexOf("Macintosh")!=-1){return"macosx";}else{if(version.indexOf("Linux")!=-1){return"linux";}}return"windows";}return null;},getPlatformID:function(){switch(SKYPE.util.ClientDetection.getPlatform()){case"windows":return 0;case"macosx":return 3;case"linux":return 2;}return"";},getOSTimezone:function(){return _getItem("os_timezone")||parseInt(new Date().getTimezoneOffset()/60);},getProfileTimezone:function(){return _getItem("ui_timezone");},getSessionUsername:function(){if(typeof _sessionso.username=="string"){var timeNow=(new Date()).getTime()/1000;if(typeof _sessionso.expires!="undefined"&&_sessionso.expires<timeNow){try{log("Session seems to have expired, clearing it in SWF");D.get(_detectionSwfID).clearSessionData();}catch(e){}return"";}return _sessionso.username;}return"";},getSkypeUserAge:function(){var installed=_getItem("ui_installdate");if(typeof installed=="string"){installed=parseInt(installed);}if(installed==null||isNaN(installed)||installed==0){return -1;}var age=Math.floor(((new Date()).getTime()/1000-installed)/60/60/24);return age;},getUserSegment:function(){return _sessionso.segment?_sessionso.segment:"";},setUserSegment:function(segment){try{var swf=D.get(_detectionSwfID);if(swf.setUserSegment){swf.setUserSegment(segment);_sessionso.segment=swf.getUserSegment();}}catch(e){}},isQualifiedVersion:function(reqver,thisver){var ver=(thisver||_getItem("ui_version")).split(".");reqver=reqver.split(".");try{if(parseInt(ver[0])>parseInt(reqver[0])||(parseInt(ver[0])==parseInt(reqver[0])&&parseInt(ver[1])>parseInt(reqver[1]))||(parseInt(ver[0])==parseInt(reqver[0])&&parseInt(ver[1])==parseInt(reqver[1])&&parseInt(ver[3])>=parseInt(reqver[3]))){return true;}}catch(e){}return false;},subscribe:function(fn,obj,override,failurefn){onDetectionAvailable.subscribe(fn,obj,override);E.onDOMReady(_loadDetection,null,this);if(typeof failurefn=="function"){onDetectionFailure.subscribe(failurefn,obj,override);}}};}();